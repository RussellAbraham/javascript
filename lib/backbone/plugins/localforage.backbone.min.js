!function(e,c){if("function"==typeof define&&define.amd)define(["localforage","backbone","underscore"],c);else if("undefined"!=typeof module&&module.exports){var n=require("localforage"),o=require("backbone"),t=require("underscore");module.exports=c(n,o,t)}else c(e.localforage,e.Backbone,e._)}(this,function(e,c,n){function o(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function t(){return o()+o()+"-"+o()+"-"+o()+"-"+o()+"-"+o()+o()+o()}function a(c,o,t,a){if(c){var s=c.map(function(e){return c.model.prototype.sync._localforageNamespace+"/"+e.id});o=o?n.partial(o,t,a):void 0,c.sync.localforageKey||r(c),e.setItem(c.sync.localforageKey,s,o)}}function r(e){e instanceof c.Collection?e.sync.localforageKey=e.sync._localforageNamespace:(e.id||(e[e.idAttribute]=e.attributes[e.idAttribute]=t()),e.sync.localforageKey=e.sync._localforageNamespace+"/"+e.id)}return c.localforage={localforageInstance:e,sync:function(e){var c=this,n=function(e,n,o){switch(r(n),e){case"read":return n.id?c.find(n,o):c.findAll(n,o);case"create":return c.create(n,o);case"update":return c.update(n,o);case"delete":return c.destroy(n,o)}};return n._localforageNamespace=e,n._localeForageKeyFn=r,n},save:function(c,n){e.setItem(c.sync.localforageKey,c.toJSON(),function(e,o){c.collection?a(c.collection,n,e,o):n&&n(o)})},create:function(e,c){return this.update(e,c)},update:function(e,c){this.save(e,function(e){c.success&&c.success(e)})},find:function(c,o){e.getItem(c.sync.localforageKey,function(e,c){e||n.isEmpty(c)?o.error&&o.error():o.success&&o.success(c)})},findAll:function(c,o){e.getItem(c.sync.localforageKey,function(c,t){if(!c&&t&&t.length){var a=function(){o.success&&o.success(t)};a=n.after(t.length,a);for(var r=function(e,c,n){t[e]=n,a()},s=0;s<t.length;++s)e.getItem(t[s],n.partial(r,s))}else t=[],o.success&&o.success(t)})},destroy:function(c,n){var o=c.collection;e.removeItem(c.sync.localforageKey,function(){o?a(o,n.success,null,c.toJSON()):n.success&&n.success(c.toJSON())})}},c.localforage});
//# sourceMappingURL=localforage.backbone.min.js.map
